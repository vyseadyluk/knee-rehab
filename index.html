<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è†ç›–åº·å¤åŠ©æ‰‹</title>
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a6fd6;
            --secondary: #764ba2;
            --success: #52c234;
            --warning: #ffa726;
            --danger: #dc3545;
            --bg-light: #f8f9ff;
            --text-dark: #333;
            --text-light: #666;
            --white: #fff;
        }

        .dark-mode {
            --primary: #8b9eff;
            --primary-dark: #7a8fff;
            --secondary: #9c6fc7;
            --success: #6dd94d;
            --warning: #ffb74d;
            --danger: #f44336;
            --bg-light: #2d2d3a;
            --text-dark: #e0e0e0;
            --text-light: #aaa;
            --white: #1e1e2e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s;
        }
        .dark-mode body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            transition: background 0.3s;
        }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        h1 { color: var(--primary); font-size: 24px; }
        .theme-toggle {
            background: var(--bg-light);
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        .subtitle { text-align: center; color: var(--text-light); margin-bottom: 15px; font-size: 13px; line-height: 1.5; }

        /* è¿›åº¦æ¡åŒºåŸŸ */
        .progress-bar-section { margin-bottom: 15px; }
        .progress-bar-container {
            background: var(--bg-light);
            border-radius: 10px;
            height: 24px;
            overflow: hidden;
            position: relative;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            min-width: 45px;
        }
        .progress-bar span { color: white; font-size: 11px; font-weight: bold; }
        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 12px;
            color: var(--text-light);
        }

        .progress-section { background: var(--bg-light); padding: 15px; border-radius: 15px; margin-bottom: 15px; }
        .progress-info { display: flex; justify-content: space-around; }
        .progress-item { text-align: center; }
        .progress-number { font-size: 28px; font-weight: bold; color: var(--primary); }
        .progress-label { font-size: 11px; color: var(--text-light); margin-top: 3px; }

        /* æœ¬å‘¨ç»Ÿè®¡ */
        .week-stats {
            background: var(--bg-light);
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .week-stats-label { font-size: 13px; color: var(--text-light); }
        .week-stats-dots { display: flex; gap: 6px; }
        .week-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #999;
        }
        .week-dot.checked { background: var(--success); color: white; }
        .week-dot.today { border: 2px solid var(--primary); }

        /* æœªæ‰“å¡æé†’ */
        .reminder-alert {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 14px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* é¼“åŠ±è¯­ */
        .motivation {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 14px;
        }

        .notification-setup { background: #fff3cd; padding: 12px; border-radius: 10px; margin-bottom: 15px; text-align: center; font-size: 13px; }
        .notification-setup button { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 13px; font-weight: bold; cursor: pointer; margin-top: 8px; }
        .notification-setup.enabled { background: #d4edda; }
        .dark-mode .notification-setup { background: #3d3d2e; color: #d4d4aa; }
        .dark-mode .notification-setup.enabled { background: #2d3d2e; color: #a4d4aa; }

        .time-settings { display: flex; gap: 15px; justify-content: center; margin-top: 8px; flex-wrap: wrap; }
        .time-input { display: flex; flex-direction: column; align-items: center; }
        .time-input label { font-size: 11px; color: var(--text-light); margin-bottom: 3px; }
        .time-input input { padding: 6px; border: 2px solid #ddd; border-radius: 6px; font-size: 13px; }

        .next-reminder { font-size: 12px; color: var(--text-light); margin-top: 8px; }

        .notification-warning { background: #f8d7da; padding: 12px; border-radius: 10px; margin-bottom: 15px; text-align: center; color: #721c24; font-size: 12px; line-height: 1.4; }
        .dark-mode .notification-warning { background: #3d2d2e; color: #d4a4a4; }

        .checkin-buttons { display: flex; gap: 10px; margin-bottom: 15px; }
        .checkin-btn { flex: 1; padding: 18px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; border: none; border-radius: 15px; font-size: 15px; font-weight: bold; cursor: pointer; }
        .checkin-btn.completed { background: linear-gradient(135deg, var(--success) 0%, #61b15a 100%); }
        .undo-btn { flex: 0 0 auto; padding: 18px; background: var(--warning); color: white; border: none; border-radius: 15px; font-size: 15px; font-weight: bold; cursor: pointer; }
        .undo-btn:disabled { background: #ccc; cursor: not-allowed; }

        /* è®­ç»ƒåŠ¨ä½œåŒºåŸŸ */
        .exercises { background: var(--bg-light); padding: 15px; border-radius: 15px; margin-bottom: 15px; }
        .exercises h2 { color: var(--text-dark); margin-bottom: 12px; font-size: 16px; display: flex; justify-content: space-between; align-items: center; }
        .collapse-all { font-size: 12px; color: var(--primary); background: none; border: none; cursor: pointer; }

        .exercise-item { background: var(--white); padding: 12px; border-radius: 10px; margin-bottom: 10px; cursor: pointer; }
        .exercise-item.phase1 { border-left: 4px solid var(--warning); }
        .exercise-item.phase2 { border-left: 4px solid var(--primary); }
        .exercise-title { font-weight: bold; color: var(--text-dark); font-size: 14px; display: flex; justify-content: space-between; align-items: center; }
        .phase-tag { font-size: 10px; padding: 2px 6px; border-radius: 8px; font-weight: normal; }
        .phase-tag.phase1 { background: #ffe0b2; color: #e65100; }
        .phase-tag.phase2 { background: #e3f2fd; color: #1565c0; }
        .dark-mode .phase-tag.phase1 { background: #4d3800; color: #ffb74d; }
        .dark-mode .phase-tag.phase2 { background: #1a3a5c; color: #8b9eff; }
        .exercise-details { font-size: 12px; color: var(--text-light); line-height: 1.5; margin-top: 8px; display: none; }
        .exercise-item.expanded .exercise-details { display: block; }
        .expand-icon { font-size: 12px; color: var(--text-light); transition: transform 0.2s; }
        .exercise-item.expanded .expand-icon { transform: rotate(180deg); }

        .note { background: #fff3cd; padding: 10px; border-radius: 8px; font-size: 12px; color: #856404; margin-top: 10px; line-height: 1.4; }
        .dark-mode .note { background: #3d3d2e; color: #d4d4aa; }

        /* æ—¥å†åŒºåŸŸ */
        .calendar-section { background: var(--bg-light); padding: 15px; border-radius: 15px; margin-bottom: 15px; }
        .month-selector { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .month-selector button { background: var(--primary); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 13px; }
        .month-selector button:disabled { background: #ccc; cursor: not-allowed; }
        .month-title { font-weight: bold; color: var(--primary); font-size: 15px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .calendar-header { text-align: center; font-size: 10px; color: #999; padding: 4px 0; font-weight: bold; }
        .calendar-day {
            aspect-ratio: 1;
            background: var(--white);
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            position: relative;
        }
        .calendar-day.other-month { opacity: 0.3; }
        .calendar-day.checked { background: var(--primary); color: white; border-color: var(--primary); }
        .calendar-day.has-note::after {
            content: '';
            position: absolute;
            bottom: 2px;
            width: 4px;
            height: 4px;
            background: var(--warning);
            border-radius: 50%;
        }
        .calendar-day.checked.has-note::after { background: white; }
        .calendar-day.today { border-color: var(--secondary); border-width: 3px; }
        .legend { display: flex; gap: 12px; justify-content: center; margin-top: 12px; font-size: 11px; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 4px; }
        .legend-box { width: 16px; height: 16px; border-radius: 4px; }
        .legend-box.phase1 { background: var(--warning); }
        .legend-box.phase2 { background: var(--primary); }
        .legend-box.has-note {
            background: #e0e0e0;
            position: relative;
        }
        .legend-box.has-note::after {
            content: '';
            position: absolute;
            bottom: 1px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--warning);
            border-radius: 50%;
        }

        /* å¤‡æ³¨æ¨¡æ€æ¡† */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-overlay.show { display: flex; }
        .modal {
            background: var(--white);
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal h3 { color: var(--primary); margin-bottom: 15px; font-size: 16px; }
        .modal textarea {
            width: 100%;
            height: 100px;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            font-size: 14px;
            resize: none;
            font-family: inherit;
        }
        .modal-buttons { display: flex; gap: 10px; margin-top: 15px; }
        .modal-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }
        .modal-buttons .save-btn { background: var(--primary); color: white; }
        .modal-buttons .cancel-btn { background: #e0e0e0; color: var(--text-dark); }
        .modal-buttons .delete-btn { background: var(--danger); color: white; flex: 0 0 auto; padding: 12px 16px; }

        /* æ•°æ®ç®¡ç†åŒºåŸŸ */
        .data-section {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        .data-section h3 { color: var(--text-dark); margin-bottom: 12px; font-size: 14px; }
        .data-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .data-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            background: var(--white);
            color: var(--text-dark);
            border: 2px solid #ddd;
        }
        .data-btn:hover { border-color: var(--primary); }

        .reset-btn { width: 100%; padding: 12px; background: var(--danger); color: white; border: none; border-radius: 10px; font-size: 13px; cursor: pointer; }

        /* é‡Œç¨‹ç¢‘å¼¹çª— */
        .milestone-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 1001;
            animation: popIn 0.3s ease;
        }
        .milestone-popup.show { display: block; }
        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        .milestone-popup h2 { font-size: 24px; margin-bottom: 10px; }
        .milestone-popup p { font-size: 16px; margin-bottom: 20px; }
        .milestone-popup button {
            background: white;
            color: var(--primary);
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        /* æ–‡ä»¶è¾“å…¥éšè— */
        #importInput { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>è†ç›–åº·å¤åŠ©æ‰‹</h1>
            <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢æ·±è‰²/æµ…è‰²æ¨¡å¼">ğŸŒ™</button>
        </div>
        <p class="subtitle">åº·å¤è®­ç»ƒè®¡åˆ’ï¼ˆ180å¤©ï¼‰Â· åšæŒè®­ç»ƒï¼Œæ—©æ—¥æ¢å¤</p>

        <!-- 180å¤©è¿›åº¦æ¡ -->
        <div class="progress-bar-section">
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar"><span id="progressPercent">0%</span></div>
            </div>
            <div class="progress-text">
                <span>ç¬¬1å¤©</span>
                <span id="progressDays">å·²æ‰“å¡ 0/180 å¤©</span>
                <span>ç¬¬180å¤©</span>
            </div>
        </div>

        <div class="progress-section">
            <div class="progress-info">
                <div class="progress-item">
                    <div class="progress-number" id="dayNumber">1</div>
                    <div class="progress-label">ç¬¬å‡ å¤©</div>
                </div>
                <div class="progress-item">
                    <div class="progress-number" id="totalCheckins">0</div>
                    <div class="progress-label">ç´¯è®¡æ‰“å¡</div>
                </div>
                <div class="progress-item">
                    <div class="progress-number" id="streak">0</div>
                    <div class="progress-label">è¿ç»­å¤©æ•°</div>
                </div>
            </div>
        </div>

        <!-- æœ¬å‘¨æ‰“å¡ç»Ÿè®¡ -->
        <div class="week-stats">
            <span class="week-stats-label">æœ¬å‘¨æ‰“å¡</span>
            <div class="week-stats-dots" id="weekDots"></div>
        </div>

        <!-- æœªæ‰“å¡æé†’ï¼ˆä¸‹åˆæ˜¾ç¤ºï¼‰ -->
        <div class="reminder-alert" id="reminderAlert" style="display:none;">
            â° ä»Šå¤©è¿˜æ²¡æ‰“å¡å“¦ï¼åˆ«å¿˜äº†åšåº·å¤è®­ç»ƒï¼
        </div>

        <!-- é¼“åŠ±è¯­ -->
        <div class="motivation" id="motivationBox" style="display:none;"></div>


        <div class="notification-setup" id="notificationStatus">
            <p>ğŸ”” å°è¯•å¼€å¯æµè§ˆå™¨é€šçŸ¥ï¼ˆç”µè„‘ç«¯æ¨èï¼‰</p>
            <button onclick="enableNotifications()">å¼€å¯é€šçŸ¥</button>
            <div class="time-settings">
                <div class="time-input">
                    <label>æ—©ä¸Šæé†’</label>
                    <input type="time" id="morningTime" value="08:00">
                </div>
                <div class="time-input">
                    <label>æ™šä¸Šæé†’</label>
                    <input type="time" id="eveningTime" value="19:00">
                </div>
            </div>
            <div class="next-reminder" id="nextReminder"></div>
        </div>

        <div class="checkin-buttons">
            <button class="checkin-btn" id="checkinBtn" onclick="dailyCheckin()">ä»Šæ—¥è®­ç»ƒæ‰“å¡</button>
            <button class="undo-btn" id="undoBtn" onclick="undoCheckin()" disabled>æ’¤é”€</button>
        </div>

        <div class="exercises">
            <h2>
                ğŸ“‹ åº·å¤è®­ç»ƒè®¡åˆ’
                <button class="collapse-all" id="collapseBtn" onclick="toggleAllExercises()">å…¨éƒ¨å±•å¼€</button>
            </h2>

            <div class="exercise-item phase1" onclick="toggleExercise(this)">
                <div class="exercise-title">
                    1. è¢«åŠ¨å±ˆè†ç»ƒä¹ 
                    <span>
                        <span class="phase-tag phase1">ç¬¬1-20å¤©</span>
                        <span class="expand-icon">â–¼</span>
                    </span>
                </div>
                <div class="exercise-details">
                    åä½å‚è…¿ã€é¡¶å¢™ã€åä½æŠ±è…¿ã€ä»°å§å‚è…¿ï¼Œ1å¤©1æ¬¡ï¼Œ1æ¬¡5åˆ†é’Ÿ<br>
                    <strong>æ³¨æ„ï¼š</strong>å±ˆè†åŠ¨ä½œè¿‡ç¨‹ä¸­ï¼Œè„šå°–åº”å§‹ç»ˆæœå‘å‰æ–¹ï¼Œè†å…³èŠ‚ä¸è„šå°–æ–¹å‘ä¸€è‡´ï¼Œå‘ˆä¸€æ¡ç›´çº¿ï¼Œé˜²æ­¢ç»ƒä¹ æ—¶è†å…³èŠ‚å‡ºç°å±ˆæ›²å†…ç¿»
                </div>
            </div>

            <div class="exercise-item phase1" onclick="toggleExercise(this)">
                <div class="exercise-title">
                    2. å„æ–¹å‘æŠ¬è…¿
                    <span>
                        <span class="phase-tag phase1">ç¬¬1-20å¤©</span>
                        <span class="expand-icon">â–¼</span>
                    </span>
                </div>
                <div class="exercise-details">
                    åŒ…æ‹¬åå‘ç›´æŠ¬è…¿ã€å¤–å‘ç›´æŠ¬è…¿å’Œå†…ä¾§æŠ¬è…¿<br>
                    æ¯æ¬¡æŠ¬è…¿ä¿æŒ5-10ç§’ï¼Œæ¯ç»„10-20æ¬¡ï¼Œæ¯å¤©2-3ç»„<br>
                    è®­ç»ƒè¿‡ç¨‹ä¸­åº”å®Œå…¨æ— ç—›ï¼Œä¸»è¦ç”¨äºæ¢å¤å’Œå¢å¼ºå¤§è…¿åŠé«‹éƒ¨è‚Œè‚‰åŠŸèƒ½<br>
                    <strong>æç¤ºï¼š</strong>ç»ƒä¹ æ—¶å¯åœ¨åä½ç›´è…¿ã€é¡¶å¢™ã€åä½æŠ±è…¿æˆ–ä»°å§å‚è…¿è¿™å››ç§æ–¹å¼ä¸­ä»»é€‰ä¸€ç§è¿›è¡Œ
                </div>
            </div>

            <div class="exercise-item phase1" onclick="toggleExercise(this)">
                <div class="exercise-title">
                    3. å•è…¿ç«™ç«‹
                    <span>
                        <span class="phase-tag phase1">ç¬¬1-20å¤©</span>
                        <span class="expand-icon">â–¼</span>
                    </span>
                </div>
                <div class="exercise-details">
                    ççœ¼ç«™ç«‹30ç§’ã€é—­çœ¼ç«™ç«‹15ç§’ï¼Œæ¯ç»„2-3æ¬¡ï¼Œæ¯å¤©2ç»„<br>
                    æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹éœ€ä¿æŒæ— ç—›ï¼Œä¸»è¦ç”¨äºæå‡ä¸‹è‚¢è‚Œè‚‰æ§åˆ¶èƒ½åŠ›å’Œå¹³è¡¡ç¨³å®šæ€§
                </div>
            </div>

            <div class="exercise-item phase2" onclick="toggleExercise(this)">
                <div class="exercise-title">
                    4. é å¢™é™è¹²
                    <span>
                        <span class="phase-tag phase2">ç¬¬20å¤©èµ·</span>
                        <span class="expand-icon">â–¼</span>
                    </span>
                </div>
                <div class="exercise-details">
                    30-120ç§’/ä¸ªï¼Œ2-3ä¸ª/å¤©æˆ–éš”å¤©<br>
                    è®­ç»ƒæ—¶åº”å®Œå…¨æ— ç—›ï¼Œç›®çš„åœ¨äºæ”¹å–„è‚Œè‚‰åŠŸèƒ½
                </div>
            </div>

            <div class="exercise-item phase2" onclick="toggleExercise(this)">
                <div class="exercise-title">
                    5. åŒè…¿ä¸‹è¹²
                    <span>
                        <span class="phase-tag phase2">ç¬¬20å¤©èµ·</span>
                        <span class="expand-icon">â–¼</span>
                    </span>
                </div>
                <div class="exercise-details">
                    10-20ä¸ª/ç»„ï¼Œ2-3ç»„/å¤©æˆ–éš”å¤©<br>
                    è®­ç»ƒæ—¶åº”å®Œå…¨æ— ç—›ï¼Œç›®çš„åœ¨äºæ”¹å–„è‚Œè‚‰åŠŸèƒ½
                </div>
            </div>

            <div class="exercise-item phase2" onclick="toggleExercise(this)">
                <div class="exercise-title">
                    6. å‰å‘å¼“æ­¥
                    <span>
                        <span class="phase-tag phase2">ç¬¬20å¤©èµ·</span>
                        <span class="expand-icon">â–¼</span>
                    </span>
                </div>
                <div class="exercise-details">
                    10-20ä¸ª/ç»„ï¼Œ2-3ç»„/å¤©æˆ–éš”å¤©<br>
                    è®­ç»ƒæ—¶åº”å®Œå…¨æ— ç—›ï¼Œç›®çš„åœ¨äºæ”¹å–„è‚Œè‚‰åŠŸèƒ½
                </div>
            </div>

            <div class="exercise-item phase2" onclick="toggleExercise(this)">
                <div class="exercise-title">
                    7. åå‘å¼“æ­¥
                    <span>
                        <span class="phase-tag phase2">ç¬¬20å¤©èµ·</span>
                        <span class="expand-icon">â–¼</span>
                    </span>
                </div>
                <div class="exercise-details">
                    10-20ä¸ª/ç»„ï¼Œ2-3ç»„/å¤©æˆ–éš”å¤©<br>
                    è®­ç»ƒæ—¶åº”å®Œå…¨æ— ç—›ï¼Œç›®çš„åœ¨äºæ”¹å–„è‚Œè‚‰åŠŸèƒ½
                </div>
            </div>

            <div class="note">
                âš ï¸ <strong>é‡è¦æç¤ºï¼š</strong>éœ€è¦è¿›è¡Œæ”¯å…·è°ƒèŠ‚ï¼Œæ— ç—›ä¸”é«˜è´¨é‡çš„è‚Œè‚‰åŠŸèƒ½è®­ç»ƒå¯ä»¥ä¿æŠ¤å¹¶ä¿ƒè¿›ç»„ç»‡ä¿®å¤ã€‚
            </div>
        </div>

        <div class="calendar-section">
            <div class="month-selector">
                <button onclick="changeMonth(-1)">â—€ ä¸Šæœˆ</button>
                <div class="month-title" id="monthTitle">2026å¹´2æœˆ</div>
                <button onclick="changeMonth(1)">ä¸‹æœˆ â–¶</button>
            </div>
            <div class="calendar-grid" id="calendar"></div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-box phase1"></div>
                    <span>ç¬¬1-20å¤©</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box phase2"></div>
                    <span>ç¬¬20å¤©èµ·</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box has-note"></div>
                    <span>æœ‰å¤‡æ³¨</span>
                </div>
            </div>
        </div>

        <!-- æ•°æ®ç®¡ç† -->
        <div class="data-section">
            <h3>ğŸ“¦ æ•°æ®ç®¡ç†</h3>
            <div class="data-buttons">
                <button class="data-btn" onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
                <button class="data-btn" onclick="document.getElementById('importInput').click()">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
            </div>
            <input type="file" id="importInput" accept=".json" onchange="importData(event)">
        </div>

        <button class="reset-btn" onclick="resetProgress()">ğŸ”„ é‡ç½®åº·å¤è®¡åˆ’</button>
    </div>

    <!-- å¤‡æ³¨æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="noteModal">
        <div class="modal">
            <h3 id="noteModalTitle">æ·»åŠ è®­ç»ƒå¤‡æ³¨</h3>
            <textarea id="noteText" placeholder="è®°å½•ä»Šå¤©çš„è®­ç»ƒæ„Ÿå—ï¼Œæ¯”å¦‚ï¼š&#10;â€¢ ä»Šå¤©è†ç›–æ„Ÿè§‰ä¸é”™&#10;â€¢ å®Œæˆäº†æ‰€æœ‰åŠ¨ä½œ&#10;â€¢ æœ‰è½»å¾®é…¸ç—›"></textarea>
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closeNoteModal()">å–æ¶ˆ</button>
                <button class="delete-btn" id="deleteNoteBtn" onclick="deleteNote()" style="display:none;">åˆ é™¤</button>
                <button class="save-btn" onclick="saveNote()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- é‡Œç¨‹ç¢‘å¼¹çª— -->
    <div class="milestone-popup" id="milestonePopup">
        <h2 id="milestoneTitle">ğŸ‰</h2>
        <p id="milestoneText"></p>
        <button onclick="closeMilestone()">å¤ªæ£’äº†ï¼</button>
    </div>

    <script>
        // é¼“åŠ±è¯­åˆ—è¡¨
        const motivations = [
            "ğŸ’ª æ¯ä¸€æ¬¡è®­ç»ƒéƒ½æ˜¯å‘åº·å¤è¿ˆè¿›çš„ä¸€æ­¥ï¼",
            "ğŸŒŸ åšæŒå°±æ˜¯èƒœåˆ©ï¼Œä½ åšå¾—å¾ˆæ£’ï¼",
            "ğŸ¯ ä¸“æ³¨å½“ä¸‹ï¼Œä¸€æ­¥ä¸€ä¸ªè„šå°ï¼",
            "ğŸŒˆ åº·å¤è·¯ä¸Šï¼Œä½ ä»ä¸å­¤å•ï¼",
            "â­ ä»Šå¤©çš„åŠªåŠ›ï¼Œæ˜å¤©çš„å¥åº·ï¼",
            "ğŸ† èƒ½åšæŒåˆ°ç°åœ¨ï¼Œå·²ç»å¾ˆäº†ä¸èµ·ï¼",
            "ğŸ’– ç…§é¡¾å¥½è‡ªå·±ï¼Œæ…¢æ…¢æ¥ä¸ç€æ€¥ï¼",
            "ğŸŒ» é˜³å…‰æ€»åœ¨é£é›¨åï¼ŒåŠ æ²¹ï¼",
            "âœ¨ ç›¸ä¿¡è‡ªå·±ï¼Œä½ ä¸€å®šå¯ä»¥ï¼",
            "ğŸŠ æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼Œå°±æ˜¯æœ€å¥½çš„ï¼"
        ];

        // é‡Œç¨‹ç¢‘é…ç½®
        const milestones = [
            { days: 7, title: "ğŸ‰ ä¸€å‘¨è¾¾æˆï¼", text: "è¿ç»­åšæŒ7å¤©ï¼Œä½ å¤ªæ£’äº†ï¼" },
            { days: 14, title: "ğŸŒŸ ä¸¤å‘¨åšæŒï¼", text: "14å¤©çš„åŠªåŠ›ï¼Œçœ‹å¾—è§çš„è¿›æ­¥ï¼" },
            { days: 20, title: "ğŸŠ ç¬¬20å¤©é‡Œç¨‹ç¢‘ï¼", text: "æ­å–œï¼ä»Šå¤©å¼€å§‹å¯ä»¥åšåé¢4ä¸ªåŠ¨ä½œäº†ï¼" },
            { days: 30, title: "ğŸ† ä¸€ä¸ªæœˆæˆå°±ï¼", text: "30å¤©åšæŒï¼Œä½ çœŸçš„å¾ˆæ£’ï¼" },
            { days: 60, title: "ğŸ’ª ä¸¤ä¸ªæœˆå‹‹ç« ï¼", text: "60å¤©çš„æ¯…åŠ›ï¼Œå€¼å¾—éª„å‚²ï¼" },
            { days: 90, title: "â­ 90å¤©å¤§å¸ˆï¼", text: "ä¸‰ä¸ªæœˆåšæŒï¼Œåº·å¤ä¹‹è·¯å·²è¿‡åŠï¼" },
            { days: 100, title: "ğŸ’¯ ç™¾æ—¥æˆå°±ï¼", text: "100å¤©ï¼è¿™ä»½åšæŒå¤ªçè´µï¼" },
            { days: 150, title: "ğŸŒˆ 150å¤©ä¼ å¥‡ï¼", text: "150å¤©çš„åšæŒï¼Œä½ æ˜¯æœ€æ£’çš„ï¼" },
            { days: 180, title: "ğŸŠ åº·å¤è®¡åˆ’å®Œæˆï¼", text: "180å¤©ï¼æ­å–œä½ å®Œæˆäº†æ•´ä¸ªåº·å¤è®¡åˆ’ï¼" }
        ];

        // åˆå§‹åŒ–æ•°æ®
        let rehabData = JSON.parse(localStorage.getItem('rehabData')) || {
            startDate: new Date().toISOString().split('T')[0],
            checkins: [],
            notes: {}, // æ–°å¢ï¼šæ¯æ—¥å¤‡æ³¨ { "2026-02-01": "ä»Šå¤©æ„Ÿè§‰ä¸é”™" }
            notificationsEnabled: false,
            morningTime: '08:00',
            eveningTime: '19:00',
            shownMilestones: [], // å·²æ˜¾ç¤ºçš„é‡Œç¨‹ç¢‘
            darkMode: false
        };

        // è¿ç§»æ—§æ•°æ®ï¼ˆå¦‚æœæ²¡æœ‰noteså­—æ®µï¼‰
        if (!rehabData.notes) rehabData.notes = {};
        if (!rehabData.shownMilestones) rehabData.shownMilestones = [];
        if (rehabData.darkMode === undefined) rehabData.darkMode = false;

        let viewingMonth = new Date();
        let currentNoteDate = null;

        // ä¿å­˜æ•°æ®
        function saveData() {
            localStorage.setItem('rehabData', JSON.stringify(rehabData));
        }

        // è®¡ç®—ä»å¼€å§‹ç¬¬å‡ å¤©
        function getCurrentDay() {
            const start = new Date(rehabData.startDate);
            const today = new Date();
            start.setHours(0, 0, 0, 0);
            today.setHours(0, 0, 0, 0);
            const diffTime = today - start;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            return Math.max(1, diffDays + 1);
        }

        // è·å–ä»Šå¤©æ—¥æœŸå­—ç¬¦ä¸²
        function getTodayString() {
            return new Date().toISOString().split('T')[0];
        }

        // ä»Šæ—¥æ‰“å¡
        function dailyCheckin() {
            const today = getTodayString();
            if (!rehabData.checkins.includes(today)) {
                rehabData.checkins.push(today);
                saveData();
                updateUI();

                // æ‰“å¡åå¼¹å‡ºå¤‡æ³¨æ¡†
                openNoteModal(today, true);

                // æ£€æŸ¥é‡Œç¨‹ç¢‘
                checkMilestones();
            } else {
                alert('ä»Šå¤©å·²ç»æ‰“å¡è¿‡äº†å“¦ï¼');
            }
        }

        // æ’¤é”€ä»Šæ—¥æ‰“å¡
        function undoCheckin() {
            const today = getTodayString();
            const index = rehabData.checkins.indexOf(today);
            if (index > -1) {
                if (confirm('ç¡®å®šè¦æ’¤é”€ä»Šå¤©çš„æ‰“å¡å—ï¼Ÿ')) {
                    rehabData.checkins.splice(index, 1);
                    delete rehabData.notes[today];
                    saveData();
                    updateUI();
                }
            }
        }

        // æ£€æŸ¥ä»Šå¤©æ˜¯å¦æ‰“å¡
        function isTodayChecked() {
            return rehabData.checkins.includes(getTodayString());
        }

        // è®¡ç®—è¿ç»­å¤©æ•°
        function calculateStreak() {
            if (rehabData.checkins.length === 0) return 0;
            const sortedCheckins = [...rehabData.checkins].sort().reverse();
            let streak = 0;
            let currentDate = new Date();
            currentDate.setHours(0, 0, 0, 0);

            for (let i = 0; i <= sortedCheckins.length; i++) {
                const expectedDate = new Date(currentDate);
                expectedDate.setDate(expectedDate.getDate() - i);
                const expectedStr = expectedDate.toISOString().split('T')[0];

                if (sortedCheckins.includes(expectedStr)) {
                    streak++;
                } else if (i > 0) {
                    break;
                }
            }
            return streak;
        }

        // æ£€æŸ¥å¹¶æ˜¾ç¤ºé‡Œç¨‹ç¢‘
        function checkMilestones() {
            const currentDay = getCurrentDay();
            const streak = calculateStreak();

            // æ£€æŸ¥ç¬¬20å¤©ç‰¹æ®Šæé†’
            if (currentDay === 20 && !rehabData.shownMilestones.includes('day20')) {
                rehabData.shownMilestones.push('day20');
                saveData();
                showMilestone("ğŸŠ è¿›å…¥ç¬¬äºŒé˜¶æ®µï¼", "æ­å–œï¼ä»ä»Šå¤©å¼€å§‹å¯ä»¥åšåé¢4ä¸ªåŠ¨ä½œäº†ï¼šé å¢™é™è¹²ã€åŒè…¿ä¸‹è¹²ã€å‰å‘å¼“æ­¥ã€åå‘å¼“æ­¥ï¼");
                return;
            }

            // æ£€æŸ¥è¿ç»­æ‰“å¡é‡Œç¨‹ç¢‘
            for (let milestone of milestones) {
                if (streak === milestone.days && !rehabData.shownMilestones.includes(`streak${milestone.days}`)) {
                    rehabData.shownMilestones.push(`streak${milestone.days}`);
                    saveData();
                    showMilestone(milestone.title, milestone.text);
                    return;
                }
            }
        }

        // æ˜¾ç¤ºé‡Œç¨‹ç¢‘å¼¹çª—
        function showMilestone(title, text) {
            document.getElementById('milestoneTitle').textContent = title;
            document.getElementById('milestoneText').textContent = text;
            document.getElementById('milestonePopup').classList.add('show');
        }

        // å…³é—­é‡Œç¨‹ç¢‘å¼¹çª—
        function closeMilestone() {
            document.getElementById('milestonePopup').classList.remove('show');
        }

        // æ‰“å¼€å¤‡æ³¨æ¨¡æ€æ¡†
        function openNoteModal(date, isNew = false) {
            currentNoteDate = date;
            const existingNote = rehabData.notes[date] || '';
            document.getElementById('noteText').value = existingNote;
            document.getElementById('noteModalTitle').textContent = isNew ? 'æ·»åŠ è®­ç»ƒå¤‡æ³¨ï¼ˆå¯é€‰ï¼‰' : `${date} çš„è®­ç»ƒå¤‡æ³¨`;
            document.getElementById('deleteNoteBtn').style.display = existingNote ? 'block' : 'none';
            document.getElementById('noteModal').classList.add('show');
        }

        // å…³é—­å¤‡æ³¨æ¨¡æ€æ¡†
        function closeNoteModal() {
            document.getElementById('noteModal').classList.remove('show');
            currentNoteDate = null;
        }

        // ä¿å­˜å¤‡æ³¨
        function saveNote() {
            const note = document.getElementById('noteText').value.trim();
            if (note) {
                rehabData.notes[currentNoteDate] = note;
            } else {
                delete rehabData.notes[currentNoteDate];
            }
            saveData();
            updateUI();
            closeNoteModal();
        }

        // åˆ é™¤å¤‡æ³¨
        function deleteNote() {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å¤‡æ³¨å—ï¼Ÿ')) {
                delete rehabData.notes[currentNoteDate];
                saveData();
                updateUI();
                closeNoteModal();
            }
        }

        // æ›´æ–°æœ¬å‘¨æ‰“å¡æ˜¾ç¤º
        function updateWeekStats() {
            const weekDots = document.getElementById('weekDots');
            weekDots.innerHTML = '';

            const today = new Date();
            const dayOfWeek = today.getDay(); // 0=å‘¨æ—¥
            const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];

            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - dayOfWeek + i);
                const dateStr = date.toISOString().split('T')[0];

                const dot = document.createElement('div');
                dot.className = 'week-dot';
                dot.textContent = weekDays[i];

                if (rehabData.checkins.includes(dateStr)) {
                    dot.classList.add('checked');
                    dot.textContent = 'âœ“';
                }
                if (dateStr === getTodayString()) {
                    dot.classList.add('today');
                }

                weekDots.appendChild(dot);
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgressBar() {
            const total = rehabData.checkins.length;
            const percent = Math.min(100, Math.round((total / 180) * 100));

            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressPercent').textContent = percent + '%';
            document.getElementById('progressDays').textContent = `å·²æ‰“å¡ ${total}/180 å¤©`;
        }

        // æ›´æ–°æœªæ‰“å¡æé†’
        function updateReminderAlert() {
            const hour = new Date().getHours();
            const reminderAlert = document.getElementById('reminderAlert');

            // ä¸‹åˆ2ç‚¹åå¦‚æœæ²¡æ‰“å¡ï¼Œæ˜¾ç¤ºæé†’
            if (hour >= 14 && !isTodayChecked()) {
                reminderAlert.style.display = 'block';
            } else {
                reminderAlert.style.display = 'none';
            }
        }

        // æ›´æ–°é¼“åŠ±è¯­
        function updateMotivation() {
            const motivationBox = document.getElementById('motivationBox');

            if (isTodayChecked()) {
                const randomMotivation = motivations[Math.floor(Math.random() * motivations.length)];
                motivationBox.textContent = randomMotivation;
                motivationBox.style.display = 'block';
            } else {
                motivationBox.style.display = 'none';
            }
        }

        // è®¡ç®—è·ç¦»ä¸‹æ¬¡æé†’çš„æ—¶é—´
        function updateNextReminder() {
            if (!rehabData.notificationsEnabled) {
                document.getElementById('nextReminder').textContent = '';
                return;
            }

            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();

            const [mH, mM] = rehabData.morningTime.split(':').map(Number);
            const [eH, eM] = rehabData.eveningTime.split(':').map(Number);
            const morningMinutes = mH * 60 + mM;
            const eveningMinutes = eH * 60 + eM;

            let nextTime, nextLabel;

            if (currentMinutes < morningMinutes) {
                nextTime = morningMinutes - currentMinutes;
                nextLabel = 'æ—©ä¸Š';
            } else if (currentMinutes < eveningMinutes) {
                nextTime = eveningMinutes - currentMinutes;
                nextLabel = 'æ™šä¸Š';
            } else {
                nextTime = (24 * 60 - currentMinutes) + morningMinutes;
                nextLabel = 'æ˜å¤©æ—©ä¸Š';
            }

            const hours = Math.floor(nextTime / 60);
            const minutes = nextTime % 60;

            let text = `â° è·ç¦»${nextLabel}æé†’è¿˜æœ‰ `;
            if (hours > 0) text += `${hours}å°æ—¶`;
            if (minutes > 0) text += `${minutes}åˆ†é’Ÿ`;

            document.getElementById('nextReminder').textContent = text;
        }

        // æ›´æ–°UI
        function updateUI() {
            const dayNum = getCurrentDay();
            document.getElementById('dayNumber').textContent = dayNum;
            document.getElementById('totalCheckins').textContent = rehabData.checkins.length;
            document.getElementById('streak').textContent = calculateStreak();

            const checkinBtn = document.getElementById('checkinBtn');
            const undoBtn = document.getElementById('undoBtn');
            if (isTodayChecked()) {
                checkinBtn.classList.add('completed');
                checkinBtn.textContent = 'ä»Šæ—¥å·²æ‰“å¡ âœ“';
                undoBtn.disabled = false;
            } else {
                checkinBtn.classList.remove('completed');
                checkinBtn.textContent = 'ä»Šæ—¥è®­ç»ƒæ‰“å¡';
                undoBtn.disabled = true;
            }

            updateProgressBar();
            updateWeekStats();
            updateReminderAlert();
            updateMotivation();
            updateNextReminder();
            updateCalendar();
            updateNotificationStatus();
            updateTheme();
        }

        // åˆ‡æ¢æœˆä»½
        function changeMonth(delta) {
            viewingMonth.setMonth(viewingMonth.getMonth() + delta);
            updateCalendar();
        }

        // æ›´æ–°æ—¥å†
        function updateCalendar() {
            const calendar = document.getElementById('calendar');
            const monthTitle = document.getElementById('monthTitle');
            calendar.innerHTML = '';

            const year = viewingMonth.getFullYear();
            const month = viewingMonth.getMonth();
            monthTitle.textContent = `${year}å¹´${month + 1}æœˆ`;

            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            weekdays.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                calendar.appendChild(header);
            });

            const firstDay = new Date(year, month, 1);
            const firstDayOfWeek = firstDay.getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const prevMonthDays = new Date(year, month, 0).getDate();

            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];

            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const cell = document.createElement('div');
                cell.className = 'calendar-day other-month';
                cell.textContent = prevMonthDays - i;
                calendar.appendChild(cell);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                cell.className = 'calendar-day';
                cell.textContent = day;
                const date = new Date(year, month, day);
                const dateStr = date.toISOString().split('T')[0];

                if (rehabData.checkins.includes(dateStr)) {
                    cell.classList.add('checked');
                }

                if (rehabData.notes[dateStr]) {
                    cell.classList.add('has-note');
                }

                if (dateStr === todayStr) {
                    cell.classList.add('today');
                }

                cell.onclick = function(e) {
                    e.stopPropagation();

                    // å¦‚æœå·²æ‰“å¡ï¼Œç‚¹å‡»æŸ¥çœ‹/ç¼–è¾‘å¤‡æ³¨
                    if (rehabData.checkins.includes(dateStr)) {
                        openNoteModal(dateStr, false);
                    } else {
                        // æœªæ‰“å¡çš„æ—¥æœŸï¼Œåˆ‡æ¢æ‰“å¡çŠ¶æ€
                        rehabData.checkins.push(dateStr);
                        saveData();
                        updateUI();
                    }
                };

                calendar.appendChild(cell);
            }

            const totalCells = calendar.children.length - 7;
            const remainingCells = 42 - totalCells;
            for (let day = 1; day <= remainingCells; day++) {
                const cell = document.createElement('div');
                cell.className = 'calendar-day other-month';
                cell.textContent = day;
                calendar.appendChild(cell);
            }
        }

        // å¼€å¯é€šçŸ¥
        async function enableNotifications() {
            if (!('Notification' in window)) {
                alert('ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥åŠŸèƒ½');
                return;
            }

            const permission = await Notification.requestPermission();
            if (permission === 'granted') {
                rehabData.notificationsEnabled = true;
                rehabData.morningTime = document.getElementById('morningTime').value;
                rehabData.eveningTime = document.getElementById('eveningTime').value;
                saveData();
                updateNotificationStatus();
                scheduleNotifications();
                new Notification('ğŸ‰ é€šçŸ¥å·²å¼€å¯', {
                    body: `ä¼šåœ¨${rehabData.morningTime}å’Œ${rehabData.eveningTime}æé†’ä½ è®­ç»ƒ`,
                });
            } else {
                alert('éœ€è¦å…è®¸é€šçŸ¥æƒé™æ‰èƒ½æé†’ä½ å“¦');
            }
        }

        // æ›´æ–°é€šçŸ¥çŠ¶æ€
        function updateNotificationStatus() {
            const statusDiv = document.getElementById('notificationStatus');
            if (rehabData.notificationsEnabled) {
                statusDiv.classList.add('enabled');
                statusDiv.querySelector('p').textContent = 'âœ… é€šçŸ¥å·²å¼€å¯';
                document.getElementById('morningTime').value = rehabData.morningTime;
                document.getElementById('eveningTime').value = rehabData.eveningTime;
                document.getElementById('morningTime').onchange = function() {
                    rehabData.morningTime = this.value;
                    saveData();
                    updateNextReminder();
                };
                document.getElementById('eveningTime').onchange = function() {
                    rehabData.eveningTime = this.value;
                    saveData();
                    updateNextReminder();
                };
            }
        }

        // å®‰æ’é€šçŸ¥
        function scheduleNotifications() {
            if (!rehabData.notificationsEnabled) return;
            setInterval(() => {
                const now = new Date();
                const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                if (!isTodayChecked()) {
                    if (currentTime === rehabData.morningTime) {
                        new Notification('ğŸŒ… æ—©ä¸Šè®­ç»ƒæ—¶é—´åˆ°äº†ï¼', {
                            body: 'è¯¥åšåº·å¤è®­ç»ƒäº†ï¼ŒåšæŒå°±æ˜¯èƒœåˆ©ï¼',
                            requireInteraction: true
                        });
                    }
                    if (currentTime === rehabData.eveningTime) {
                        new Notification('ğŸŒ™ æ™šä¸Šè®­ç»ƒæ—¶é—´åˆ°äº†ï¼', {
                            body: 'åˆ«å¿˜äº†ä»Šå¤©çš„åº·å¤è®­ç»ƒå“¦ï¼',
                            requireInteraction: true
                        });
                    }
                }
                updateNextReminder();
            }, 60000);
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const dataStr = JSON.stringify(rehabData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `è†ç›–åº·å¤æ•°æ®_${getTodayString()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('âœ… æ•°æ®å·²å¯¼å‡ºï¼è¯·å¦¥å–„ä¿å­˜æ–‡ä»¶ï¼Œæ¢è®¾å¤‡æ—¶å¯ä»¥å¯¼å…¥æ¢å¤ã€‚');
        }

        // å¯¼å…¥æ•°æ®
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);

                    // éªŒè¯æ•°æ®æ ¼å¼
                    if (!importedData.startDate || !Array.isArray(importedData.checkins)) {
                        throw new Error('æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                    }

                    if (confirm(`ç¡®å®šè¦å¯¼å…¥æ•°æ®å—ï¼Ÿ\n\nå¯¼å…¥çš„æ•°æ®åŒ…å«ï¼š\nâ€¢ å¼€å§‹æ—¥æœŸï¼š${importedData.startDate}\nâ€¢ æ‰“å¡è®°å½•ï¼š${importedData.checkins.length}å¤©\nâ€¢ å¤‡æ³¨è®°å½•ï¼š${Object.keys(importedData.notes || {}).length}æ¡\n\nâš ï¸ è¿™å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼`)) {
                        // åˆå¹¶æ•°æ®ï¼Œä¿ç•™ä¸€äº›æœ¬åœ°è®¾ç½®
                        rehabData = {
                            ...importedData,
                            notes: importedData.notes || {},
                            shownMilestones: importedData.shownMilestones || [],
                            darkMode: rehabData.darkMode // ä¿ç•™å½“å‰ä¸»é¢˜è®¾ç½®
                        };
                        saveData();
                        viewingMonth = new Date();
                        updateUI();
                        alert('âœ… æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                    }
                } catch (err) {
                    alert('âŒ å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ç¡®è®¤æ˜¯æ­£ç¡®çš„å¤‡ä»½æ–‡ä»¶ã€‚');
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // æ¸…ç©ºinputï¼Œå…è®¸é‡å¤å¯¼å…¥åŒä¸€æ–‡ä»¶
        }

        // é‡ç½®è¿›åº¦
        function resetProgress() {
            if (confirm('ç¡®å®šè¦é‡ç½®åº·å¤è®¡åˆ’å—ï¼Ÿ\n\nâš ï¸ è¿™å°†æ¸…é™¤æ‰€æœ‰æ‰“å¡è®°å½•å’Œå¤‡æ³¨ï¼Œä»ç¬¬1å¤©é‡æ–°å¼€å§‹ã€‚\n\nå»ºè®®å…ˆå¯¼å‡ºæ•°æ®å¤‡ä»½ï¼')) {
                rehabData = {
                    startDate: new Date().toISOString().split('T')[0],
                    checkins: [],
                    notes: {},
                    notificationsEnabled: rehabData.notificationsEnabled,
                    morningTime: rehabData.morningTime,
                    eveningTime: rehabData.eveningTime,
                    shownMilestones: [],
                    darkMode: rehabData.darkMode
                };
                saveData();
                viewingMonth = new Date();
                updateUI();
                alert('åº·å¤è®¡åˆ’å·²é‡ç½®ï¼Œä»ç¬¬1å¤©å¼€å§‹ï¼');
            }
        }

        // å±•å¼€/æŠ˜å è®­ç»ƒåŠ¨ä½œ
        function toggleExercise(element) {
            element.classList.toggle('expanded');
            updateCollapseButton();
        }

        function toggleAllExercises() {
            const items = document.querySelectorAll('.exercise-item');
            const allExpanded = Array.from(items).every(item => item.classList.contains('expanded'));

            items.forEach(item => {
                if (allExpanded) {
                    item.classList.remove('expanded');
                } else {
                    item.classList.add('expanded');
                }
            });
            updateCollapseButton();
        }

        function updateCollapseButton() {
            const items = document.querySelectorAll('.exercise-item');
            const allExpanded = Array.from(items).every(item => item.classList.contains('expanded'));
            document.getElementById('collapseBtn').textContent = allExpanded ? 'å…¨éƒ¨æŠ˜å ' : 'å…¨éƒ¨å±•å¼€';
        }

        // æ·±è‰²æ¨¡å¼
        function toggleTheme() {
            rehabData.darkMode = !rehabData.darkMode;
            saveData();
            updateTheme();
        }

        function updateTheme() {
            if (rehabData.darkMode) {
                document.documentElement.classList.add('dark-mode');
                document.querySelector('.theme-toggle').textContent = 'â˜€ï¸';
            } else {
                document.documentElement.classList.remove('dark-mode');
                document.querySelector('.theme-toggle').textContent = 'ğŸŒ™';
            }
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('noteModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeNoteModal();
            }
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            updateUI();
            if (rehabData.notificationsEnabled) {
                scheduleNotifications();
            }

            // æ£€æŸ¥æ˜¯å¦ç¬¬20å¤©ï¼ˆé¦–æ¬¡è¿›å…¥æ—¶æ£€æŸ¥ï¼‰
            const currentDay = getCurrentDay();
            if (currentDay >= 20 && !rehabData.shownMilestones.includes('day20')) {
                rehabData.shownMilestones.push('day20');
                saveData();
                showMilestone("ğŸŠ è¿›å…¥ç¬¬äºŒé˜¶æ®µï¼", "æ­å–œï¼ä»ä»Šå¤©å¼€å§‹å¯ä»¥åšåé¢4ä¸ªåŠ¨ä½œäº†ï¼šé å¢™é™è¹²ã€åŒè…¿ä¸‹è¹²ã€å‰å‘å¼“æ­¥ã€åå‘å¼“æ­¥ï¼");
            }

            // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡æé†’ç›¸å…³çŠ¶æ€
            setInterval(() => {
                updateReminderAlert();
                updateNextReminder();
            }, 60000);
        };
    </script>
</body>
</html>
